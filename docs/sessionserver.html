<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.4" />
<title>experimenttools.sessionserver API documentation</title>
<meta name="description" content="Serve a session or set of sessions â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>experimenttools.sessionserver</code></h1>
</header>
<section id="section-intro">
<p>Serve a session or set of sessions.</p>
<p><code>python -m experimenttools.sessionserver SESSION_DIR [SESSION_DIR...]</code>
serves the experiments saved in each <code>SESSION_DIR</code> together.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;Serve a session or set of sessions.

`python -m experimenttools.sessionserver SESSION_DIR [SESSION_DIR...]`
serves the experiments saved in each `SESSION_DIR` together.

&#34;&#34;&#34;
import contextlib
import http.server
import os
import socket
from pathlib import Path

from experimenttools import Session


class SessionServer:
    &#34;&#34;&#34;Handles serving of session files.

    Allows for multiple sessions to be displayed on the same server. Gathers
    the html files generated by each session and links them to an output
    directory. Then, that directory can be served.

    Examples
    --------
    &gt;&gt;&gt; import experimenttools as et
    &gt;&gt;&gt; import tempfile
    &gt;&gt;&gt; m0 = et.metrics.NumericMetric(&#34;m0&#34;)
    &gt;&gt;&gt; session_dir = tempfile.mkdtemp()
    &gt;&gt;&gt; server_dir = tempfile.mkdtemp()
    &gt;&gt;&gt; session = et.Session(session_dir, name=&#34;sess&#34;, metrics=[m0])
    &gt;&gt;&gt; server = et.SessionServer([session], server_dir)
    &gt;&gt;&gt; for i in range(5):
    ...     m0(i)
    &gt;&gt;&gt; session.plot() # Writes plots to &#39;experiment/index.html&#39;

    Then, run `python -m experimenttools.sessionserver SESSION_DIR` to serve the
    sessions while experiments are running. Or, do it programatically using
    `server.serve()` at the end of the experiment.

    Alternatively, you can pass in a list of
    `(session_name, session_output_dir)` tuples to `SessionServer`
    &gt;&gt;&gt; session_spec = (session.name, session.output_dir)
    &gt;&gt;&gt; server = et.SessionServer([session_spec], server_dir)

    &#34;&#34;&#34;

    def __init__(self, sessions, output_dir):
        self.output_dir = Path(output_dir)
        for session in sessions:
            self.add_session(session)

    def add_session(self, session):
        &#34;&#34;&#34;Add a session to the server.

        Parameters
        ----------
        session : Sesssion or (str, str)
                The `Session` to add. If passing in a `Session`, the session
                will be updated before it is added to ensure that its outputs
                have been created. If `(str, str)`, the first `str` should be
                the session name and the second should be the session output
                directory. Ensure that session has been updated if using this
                method.

        &#34;&#34;&#34;
        if isinstance(session, Session):
            if session.name is None:
                raise ValueError(
                    &#34;Sessions must have names to be added to a session server.&#34;
                )
            # Update the session so that index.html is generated
            session.update()
            sess_name = session.name
            sess_output_dir = session.output_dir
        else:
            sess_name, sess_output_dir = session
            sess_output_dir = Path(sess_output_dir)
        self.output_dir.mkdir(exist_ok=True, parents=True)
        src_html_path = sess_output_dir / &#34;index.html&#34;
        dest_html_path = self.output_dir / f&#34;{sess_name}.html&#34;
        if dest_html_path.is_file():
            dest_html_path.unlink()
        os.link(src_html_path, dest_html_path)

    def serve(self, port=8000, bind=&#34;127.0.0.1&#34;):
        &#34;&#34;&#34;Start the server.

        Parameters
        ----------
        port: int
                The port to serve to.
        bind: str
                The bind address.

        &#34;&#34;&#34;
        output_dir = self.output_dir

        class DualStackServer(http.server.ThreadingHTTPServer):
            def server_bind(self):
                # suppress exception when protocol is IPv4
                with contextlib.suppress(Exception):
                    self.socket.setsockopt(socket.IPPROTO_IPV6, socket.IPV6_V6ONLY, 0)
                return super().server_bind()

            def finish_request(self, request, client_address):
                self.RequestHandlerClass(
                    request, client_address, self, directory=str(output_dir)
                )

        http.server.test(
            HandlerClass=http.server.SimpleHTTPRequestHandler,
            ServerClass=DualStackServer,
            port=port,
            bind=bind,
        )


if __name__ == &#34;__main__&#34;:
    import argparse
    import tempfile

    parser = argparse.ArgumentParser(description=&#34;Serve a set of sessions.&#34;)
    parser.add_argument(&#34;session_dir&#34;, nargs=&#34;+&#34;, help=&#34;Session directory to serve.&#34;)
    parser.add_argument(
        &#34;--session_name&#34;,
        nargs=&#34;+&#34;,
        help=&#34;Optional name for each &#39;session_dir&#39;. If not specified, the parent &#34;
        &#34;directory of each &#39;session_dir&#39; is used as the name.&#34;,
    )
    parser.add_argument(&#34;--port&#34;, type=int, default=8888, help=&#34;Port to serve to.&#34;)
    parser.add_argument(&#34;--bind&#34;, default=&#34;127.0.0.1&#34;, help=&#34;Bind address for serving.&#34;)
    args = parser.parse_args()

    # Create local temporary directory to prevent cross-device links
    local_tmp = Path(&#34;.tmp&#34;).resolve()
    local_tmp.mkdir(exist_ok=True)
    with tempfile.TemporaryDirectory(
        prefix=&#34;experimenttools_server&#34;, dir=local_tmp
    ) as tmp_dir:
        if args.session_name:
            if len(args.session_name) != len(args.session_dir):
                raise ValueError(
                    &#34;Number of &#39;session_name&#39;s specified must match number of &#34;
                    &#34;&#39;session_dir&#39;s&#34;
                )
            session_name = args.session_name
        else:
            session_name = [Path(sd).parent.name for sd in args.session_dir]
        server = SessionServer(zip(session_name, args.session_dir), tmp_dir)
        server.serve(port=args.port, bind=args.bind)

    # Remove local temp directory if empty
    try:
        local_tmp.rmdir()
    except OSError:
        pass</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="experimenttools.sessionserver.SessionServer"><code class="flex name class">
<span>class <span class="ident">SessionServer</span></span>
<span>(</span><span>sessions, output_dir)</span>
</code></dt>
<dd>
<div class="desc"><p>Handles serving of session files.</p>
<p>Allows for multiple sessions to be displayed on the same server. Gathers
the html files generated by each session and links them to an output
directory. Then, that directory can be served.</p>
<h2 id="examples">Examples</h2>
<pre><code class="python">&gt;&gt;&gt; import experimenttools as et
&gt;&gt;&gt; import tempfile
&gt;&gt;&gt; m0 = et.metrics.NumericMetric(&quot;m0&quot;)
&gt;&gt;&gt; session_dir = tempfile.mkdtemp()
&gt;&gt;&gt; server_dir = tempfile.mkdtemp()
&gt;&gt;&gt; session = et.Session(session_dir, name=&quot;sess&quot;, metrics=[m0])
&gt;&gt;&gt; server = et.SessionServer([session], server_dir)
&gt;&gt;&gt; for i in range(5):
...     m0(i)
&gt;&gt;&gt; session.plot() # Writes plots to 'experiment/index.html'
</code></pre>
<p>Then, run <code>python -m experimenttools.sessionserver SESSION_DIR</code> to serve the
sessions while experiments are running. Or, do it programatically using
<code>server.serve()</code> at the end of the experiment.</p>
<p>Alternatively, you can pass in a list of
<code>(session_name, session_output_dir)</code> tuples to <code><a title="experimenttools.sessionserver.SessionServer" href="#experimenttools.sessionserver.SessionServer">SessionServer</a></code></p>
<pre><code class="python">&gt;&gt;&gt; session_spec = (session.name, session.output_dir)
&gt;&gt;&gt; server = et.SessionServer([session_spec], server_dir)
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class SessionServer:
    &#34;&#34;&#34;Handles serving of session files.

    Allows for multiple sessions to be displayed on the same server. Gathers
    the html files generated by each session and links them to an output
    directory. Then, that directory can be served.

    Examples
    --------
    &gt;&gt;&gt; import experimenttools as et
    &gt;&gt;&gt; import tempfile
    &gt;&gt;&gt; m0 = et.metrics.NumericMetric(&#34;m0&#34;)
    &gt;&gt;&gt; session_dir = tempfile.mkdtemp()
    &gt;&gt;&gt; server_dir = tempfile.mkdtemp()
    &gt;&gt;&gt; session = et.Session(session_dir, name=&#34;sess&#34;, metrics=[m0])
    &gt;&gt;&gt; server = et.SessionServer([session], server_dir)
    &gt;&gt;&gt; for i in range(5):
    ...     m0(i)
    &gt;&gt;&gt; session.plot() # Writes plots to &#39;experiment/index.html&#39;

    Then, run `python -m experimenttools.sessionserver SESSION_DIR` to serve the
    sessions while experiments are running. Or, do it programatically using
    `server.serve()` at the end of the experiment.

    Alternatively, you can pass in a list of
    `(session_name, session_output_dir)` tuples to `SessionServer`
    &gt;&gt;&gt; session_spec = (session.name, session.output_dir)
    &gt;&gt;&gt; server = et.SessionServer([session_spec], server_dir)

    &#34;&#34;&#34;

    def __init__(self, sessions, output_dir):
        self.output_dir = Path(output_dir)
        for session in sessions:
            self.add_session(session)

    def add_session(self, session):
        &#34;&#34;&#34;Add a session to the server.

        Parameters
        ----------
        session : Sesssion or (str, str)
                The `Session` to add. If passing in a `Session`, the session
                will be updated before it is added to ensure that its outputs
                have been created. If `(str, str)`, the first `str` should be
                the session name and the second should be the session output
                directory. Ensure that session has been updated if using this
                method.

        &#34;&#34;&#34;
        if isinstance(session, Session):
            if session.name is None:
                raise ValueError(
                    &#34;Sessions must have names to be added to a session server.&#34;
                )
            # Update the session so that index.html is generated
            session.update()
            sess_name = session.name
            sess_output_dir = session.output_dir
        else:
            sess_name, sess_output_dir = session
            sess_output_dir = Path(sess_output_dir)
        self.output_dir.mkdir(exist_ok=True, parents=True)
        src_html_path = sess_output_dir / &#34;index.html&#34;
        dest_html_path = self.output_dir / f&#34;{sess_name}.html&#34;
        if dest_html_path.is_file():
            dest_html_path.unlink()
        os.link(src_html_path, dest_html_path)

    def serve(self, port=8000, bind=&#34;127.0.0.1&#34;):
        &#34;&#34;&#34;Start the server.

        Parameters
        ----------
        port: int
                The port to serve to.
        bind: str
                The bind address.

        &#34;&#34;&#34;
        output_dir = self.output_dir

        class DualStackServer(http.server.ThreadingHTTPServer):
            def server_bind(self):
                # suppress exception when protocol is IPv4
                with contextlib.suppress(Exception):
                    self.socket.setsockopt(socket.IPPROTO_IPV6, socket.IPV6_V6ONLY, 0)
                return super().server_bind()

            def finish_request(self, request, client_address):
                self.RequestHandlerClass(
                    request, client_address, self, directory=str(output_dir)
                )

        http.server.test(
            HandlerClass=http.server.SimpleHTTPRequestHandler,
            ServerClass=DualStackServer,
            port=port,
            bind=bind,
        )</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="experimenttools.sessionserver.SessionServer.add_session"><code class="name flex">
<span>def <span class="ident">add_session</span></span>(<span>self, session)</span>
</code></dt>
<dd>
<div class="desc"><p>Add a session to the server.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>session</code></strong> :&ensp;<code>Sesssion</code> or <code>(str, str)</code></dt>
<dd>The <code>Session</code> to add. If passing in a <code>Session</code>, the session
will be updated before it is added to ensure that its outputs
have been created. If <code>(str, str)</code>, the first <code>str</code> should be
the session name and the second should be the session output
directory. Ensure that session has been updated if using this
method.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def add_session(self, session):
    &#34;&#34;&#34;Add a session to the server.

    Parameters
    ----------
    session : Sesssion or (str, str)
            The `Session` to add. If passing in a `Session`, the session
            will be updated before it is added to ensure that its outputs
            have been created. If `(str, str)`, the first `str` should be
            the session name and the second should be the session output
            directory. Ensure that session has been updated if using this
            method.

    &#34;&#34;&#34;
    if isinstance(session, Session):
        if session.name is None:
            raise ValueError(
                &#34;Sessions must have names to be added to a session server.&#34;
            )
        # Update the session so that index.html is generated
        session.update()
        sess_name = session.name
        sess_output_dir = session.output_dir
    else:
        sess_name, sess_output_dir = session
        sess_output_dir = Path(sess_output_dir)
    self.output_dir.mkdir(exist_ok=True, parents=True)
    src_html_path = sess_output_dir / &#34;index.html&#34;
    dest_html_path = self.output_dir / f&#34;{sess_name}.html&#34;
    if dest_html_path.is_file():
        dest_html_path.unlink()
    os.link(src_html_path, dest_html_path)</code></pre>
</details>
</dd>
<dt id="experimenttools.sessionserver.SessionServer.serve"><code class="name flex">
<span>def <span class="ident">serve</span></span>(<span>self, port=8000, bind='127.0.0.1')</span>
</code></dt>
<dd>
<div class="desc"><p>Start the server.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>port</code></strong> :&ensp;<code>int</code></dt>
<dd>The port to serve to.</dd>
<dt><strong><code>bind</code></strong> :&ensp;<code>str</code></dt>
<dd>The bind address.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def serve(self, port=8000, bind=&#34;127.0.0.1&#34;):
    &#34;&#34;&#34;Start the server.

    Parameters
    ----------
    port: int
            The port to serve to.
    bind: str
            The bind address.

    &#34;&#34;&#34;
    output_dir = self.output_dir

    class DualStackServer(http.server.ThreadingHTTPServer):
        def server_bind(self):
            # suppress exception when protocol is IPv4
            with contextlib.suppress(Exception):
                self.socket.setsockopt(socket.IPPROTO_IPV6, socket.IPV6_V6ONLY, 0)
            return super().server_bind()

        def finish_request(self, request, client_address):
            self.RequestHandlerClass(
                request, client_address, self, directory=str(output_dir)
            )

    http.server.test(
        HandlerClass=http.server.SimpleHTTPRequestHandler,
        ServerClass=DualStackServer,
        port=port,
        bind=bind,
    )</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="experimenttools" href="index.html">experimenttools</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="experimenttools.sessionserver.SessionServer" href="#experimenttools.sessionserver.SessionServer">SessionServer</a></code></h4>
<ul class="">
<li><code><a title="experimenttools.sessionserver.SessionServer.add_session" href="#experimenttools.sessionserver.SessionServer.add_session">add_session</a></code></li>
<li><code><a title="experimenttools.sessionserver.SessionServer.serve" href="#experimenttools.sessionserver.SessionServer.serve">serve</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.4</a>.</p>
</footer>
</body>
</html>